<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · MixedModelsSmallSample.jl</title><meta name="title" content="Home · MixedModelsSmallSample.jl"/><meta property="og:title" content="Home · MixedModelsSmallSample.jl"/><meta property="twitter:title" content="Home · MixedModelsSmallSample.jl"/><meta name="description" content="Documentation for MixedModelsSmallSample.jl."/><meta property="og:description" content="Documentation for MixedModelsSmallSample.jl."/><meta property="twitter:description" content="Documentation for MixedModelsSmallSample.jl."/><meta property="og:url" content="https://ArnoStrouwen.github.io/MixedModelsSmallSample.jl/"/><meta property="twitter:url" content="https://ArnoStrouwen.github.io/MixedModelsSmallSample.jl/"/><link rel="canonical" href="https://ArnoStrouwen.github.io/MixedModelsSmallSample.jl/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>MixedModelsSmallSample.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Getting-Started"><span>Getting Started</span></a></li><li><a class="tocitem" href="#Multiple-random-effects"><span>Multiple random effects</span></a></li><li><a class="tocitem" href="#More-examples"><span>More examples</span></a></li><li><a class="tocitem" href="#Similar-software"><span>Similar software</span></a></li><li><a class="tocitem" href="#How-It-Works"><span>How It Works</span></a></li><li><a class="tocitem" href="#API-Reference"><span>API Reference</span></a></li><li><a class="tocitem" href="#Internals"><span>Internals</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/master/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.MixedModelsSmallSample"><a class="docstring-binding" href="#MixedModelsSmallSample.MixedModelsSmallSample"><code>MixedModelsSmallSample.MixedModelsSmallSample</code></a> — <span class="docstring-category">Module</span></summary><section><div><pre><code class="language-julia hljs">MixedModelsSmallSample</code></pre><p>Small-sample corrections for linear mixed models fitted by <a href="https://juliastats.org/MixedModels.jl/stable/">MixedModels.jl</a>.</p><p><strong>Linear Mixed Model</strong></p><p>A linear mixed model expresses the <span>$n$</span>-vector of responses as</p><p class="math-container">\[y = X\beta + Zu + \varepsilon, \quad
u \sim \mathcal{N}(0, G(\theta)), \quad
\varepsilon \sim \mathcal{N}(0, \sigma^2 I_n),\]</p><p>where <span>$X$</span> is the <span>$n \times p$</span> fixed-effects design matrix, <span>$\beta$</span> is the <span>$p$</span>-vector of fixed-effects coefficients, <span>$Z$</span> is the random-effects design matrix, <span>$u$</span> is the vector of random effects with covariance <span>$G(\theta)$</span>, and <span>$\varepsilon$</span> is the residual error.</p><p>The marginal variance of <span>$y$</span> is</p><p class="math-container">\[V(\theta) = ZG(\theta)Z^\top + \sigma^2 I_n.\]</p><p><strong>The Small-Sample Problem</strong></p><p>The generalized least squares estimator <span>$\hat{\beta}$</span> has covariance</p><p class="math-container">\[\Phi(\theta) = (X^\top V(\theta)^{-1} X)^{-1}.\]</p><p>Standard inference replaces <span>$\theta$</span> with its REML estimate <span>$\hat{\theta}$</span>, yielding <span>$\hat{\Phi} = \Phi(\hat{\theta})$</span>, and uses asymptotic approximations (e.g., treating <span>$t$</span>-statistics as normally distributed). For small samples, this ignores:</p><ol><li><strong>Bias</strong> in <span>$\hat{\Phi}$</span> due to estimating <span>$\theta$</span></li><li><strong>Uncertainty</strong> in <span>$\hat{\theta}$</span> affecting the reference distribution</li></ol><p>This package implements two corrections:</p><ul><li><strong>Kenward-Roger</strong> (<a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a>): Applies a bias correction to <span>$\hat{\Phi}$</span> and uses a scaled F-distribution with approximate degrees of freedom.</li><li><strong>Satterthwaite</strong> (<a href="#MixedModelsSmallSample.Satterthwaite"><code>Satterthwaite</code></a>): Uses moment-matching to approximate degrees of freedom for the t/F reference distribution.</li></ul><p><strong>References</strong></p><ul><li>Kenward, M. G. and Roger, J. H. (1997). &quot;Small sample inference for fixed effects from restricted maximum likelihood.&quot; <em>Biometrics</em>, 53(3), 983-997.</li><li>Satterthwaite, F. E. (1946). &quot;An Approximate Distribution of Estimates of Variance Components.&quot; <em>Biometrics Bulletin</em>, 2(6), 110-114.</li><li>Fai, A. H.-T. and Cornelius, P. L. (1996). &quot;Approximate F-tests of multiple degree of freedom hypotheses in generalized least squares analyses of unbalanced split-plot experiments.&quot; <em>Journal of Statistical Computation and Simulation</em>, 54(4), 363-378.</li></ul><p><strong>See Also</strong></p><ul><li><a href="#MixedModelsSmallSample.small_sample_adjust"><code>small_sample_adjust</code></a>: Apply KR or SW adjustment to a fitted model</li><li><a href="#MixedModelsSmallSample.small_sample_ftest"><code>small_sample_ftest</code></a>: Perform an adjusted F-test for contrasts</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/MixedModelsSmallSample.jl#L1-L67">source</a></section></details></article><h2 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h2><p>We will look at a split plot experiment, described in chapter 10 of:</p><blockquote><p>Goos, Peter, and Bradley Jones. Optimal design of experiments: a case study approach. John Wiley &amp; Sons, 2011.</p></blockquote><p>Split-plot experiments have hard-to-change factors and easy-to-change factors. Hard-to-change factors are not properly randomized, they are kept at the same factor setting for multiple observations. The dataset can thus be split up into blocks, where the hard-to-change factors remain constant. These blocks are also called whole plots. The observations within such a block are more similar to one another than observations coming from a different block. A random intercept per block is introduced to deal with the correlation between observations. In the below dataset, FRH and RRH are hard-to-change, while YA and GC are easy-to-change. The WP column shows that there are 10 blocks in the dataset in which FRH and RRH remain constant. Efficiency is the output we want to model.</p><details><summary>Click here to expand the details loading the data.</summary><pre><code class="language-julia hljs">#! format: off
using DataFrames
df = DataFrame(
  WP = [1,1,1,1,1,
        2,2,2,2,2,
        3,3,3,3,3,
        4,4,4,4,4,
        5,5,5,5,5,
        6,6,6,6,6,
        7,7,7,7,7,
        8,8,8,8,8,
        9,9,9,9,9,
        10,10,10,10,10],
  FRH = [-1,-1,-1,-1,-1,
         0,0,0,0,0,
         1,1,1,1,1,
         -1,-1,-1,-1,-1,
         0,0,0,0,0,
         0,0,0,0,0,
         1,1,1,1,1,
         -1,-1,-1,-1,-1,
         0,0,0,0,0,
         1,1,1,1,1],
  RRH = [-1,-1,-1,-1,-1,
         -1,-1,-1,-1,-1,
         -1,-1,-1,-1,-1,
         0,0,0,0,0,
         0,0,0,0,0,
         0,0,0,0,0,
         0,0,0,0,0,
         1,1,1,1,1,
         1,1,1,1,1,
         1,1,1,1,1],
  YA = [-1,1,0,1,-1,
        1,0,1,0,-1,
        1,1,-1,-1,0,
        -1,0,1,0,-1,
        0,1,0,-1,0,
        1,0,0,0,-1,
        0,1,0,0,-1,
        -1,1,0,1,-1,
        -1,0,0,0,1,
        -1,1,-1,1,0],
  GC = [-1,1,0,-1,1,
        1,0,-1,1,0,
        -1,1,-1,1,0,
        0,1,0,-1,1,
        -1,0,0,1,0,
        0,0,0,0,-1,
        -1, 1,0,1,0,
        -1,-1,0,1,1,
        0,-1,0,1,1,
        1,-1,-1,0,1],
  EFFICIENCY = [
                0.873,0.969,0.959,0.821,1.019,
                0.921,0.923,0.821,0.958,0.914,
                0.705,0.861,0.756,0.861,0.78,
                0.999,1.06,0.91,0.854,1.082,
                0.841,0.885,0.905,1.025,0.936,
                0.844,0.891,0.902,0.871,0.833,
                0.786,0.879,0.86,0.905,0.87,
                0.98,0.907,1.045,1.094,1.159,
                1.0,0.901,0.99,1.059,1.025,
                0.991,0.828,0.853,0.923,0.997
                ]
  )</code></pre><div><div style = "float: left;"><span>50×6 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">WP</th><th style = "text-align: left;">FRH</th><th style = "text-align: left;">RRH</th><th style = "text-align: left;">YA</th><th style = "text-align: left;">GC</th><th style = "text-align: left;">EFFICIENCY</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.873</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.969</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.959</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.821</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.019</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.921</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.923</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.821</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.958</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.914</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.705</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.861</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.756</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.861</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.78</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: right;">4</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.999</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: right;">4</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.06</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: right;">4</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.91</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">19</td><td style = "text-align: right;">4</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.854</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">20</td><td style = "text-align: right;">4</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.082</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">21</td><td style = "text-align: right;">5</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.841</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">22</td><td style = "text-align: right;">5</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.885</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">23</td><td style = "text-align: right;">5</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.905</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">24</td><td style = "text-align: right;">5</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.025</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">25</td><td style = "text-align: right;">5</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.936</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">26</td><td style = "text-align: right;">6</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.844</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">27</td><td style = "text-align: right;">6</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.891</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">28</td><td style = "text-align: right;">6</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.902</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">29</td><td style = "text-align: right;">6</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.871</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">30</td><td style = "text-align: right;">6</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.833</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">31</td><td style = "text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.786</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">32</td><td style = "text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.879</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">33</td><td style = "text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.86</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">34</td><td style = "text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.905</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">35</td><td style = "text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.87</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">36</td><td style = "text-align: right;">8</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.98</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">37</td><td style = "text-align: right;">8</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.907</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">38</td><td style = "text-align: right;">8</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1.045</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">39</td><td style = "text-align: right;">8</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.094</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">40</td><td style = "text-align: right;">8</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.159</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">41</td><td style = "text-align: right;">9</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1.0</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">42</td><td style = "text-align: right;">9</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.901</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">43</td><td style = "text-align: right;">9</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.99</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">44</td><td style = "text-align: right;">9</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.059</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">45</td><td style = "text-align: right;">9</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.025</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">46</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.991</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">47</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.828</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">48</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.853</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">49</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.923</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">50</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.997</td></tr></tbody></table></div></details><pre><code class="language-julia hljs">df[1:10, :]</code></pre><div><div style = "float: left;"><span>10×6 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">WP</th><th style = "text-align: left;">FRH</th><th style = "text-align: left;">RRH</th><th style = "text-align: left;">YA</th><th style = "text-align: left;">GC</th><th style = "text-align: left;">EFFICIENCY</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.873</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.969</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.959</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.821</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.019</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.921</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.923</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.821</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.958</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">2</td><td style = "text-align: right;">0</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.914</td></tr></tbody></table></div><pre><code class="language-julia hljs">df[45:50, :]</code></pre><div><div style = "float: left;"><span>6×6 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">WP</th><th style = "text-align: left;">FRH</th><th style = "text-align: left;">RRH</th><th style = "text-align: left;">YA</th><th style = "text-align: left;">GC</th><th style = "text-align: left;">EFFICIENCY</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">9</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.025</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.991</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.828</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">-1</td><td style = "text-align: right;">0.853</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">0.923</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1</td><td style = "text-align: right;">0.997</td></tr></tbody></table></div><p>We work with a full quadratic model, where the intercept is allowed to vary between blocks. First, we get the output using only <code>MixedModels</code>. Here, the p-values for the main effects (first-order terms) are all below <code>1e-10</code>.</p><pre><code class="language-julia hljs">using MixedModels
fm = @formula(
    EFFICIENCY ~
        1 +
    (1 | WP) +
    FRH +
    RRH +
    YA +
    GC +
    FRH &amp; RRH +
    FRH &amp; YA +
    FRH &amp; GC +
    RRH &amp; YA +
    RRH &amp; GC +
    YA &amp; GC +
    FRH &amp; FRH +
    RRH &amp; RRH +
    YA &amp; YA +
    GC &amp; GC
)
m = fit(MixedModel, fm, df; REML=true)</code></pre><table><tr><th align="left"></th><th align="right">Est.</th><th align="right">SE</th><th align="right">z</th><th align="right">p</th><th align="right">σ_WP</th></tr><tr><td align="left">&#40;Intercept&#41;</td><td align="right">0.9114</td><td align="right">0.0117</td><td align="right">77.67</td><td align="right">&lt;1e-99</td><td align="right">0.0182</td></tr><tr><td align="left">FRH</td><td align="right">-0.0609</td><td align="right">0.0079</td><td align="right">-7.70</td><td align="right">&lt;1e-13</td><td align="right"> </td></tr><tr><td align="left">RRH</td><td align="right">0.0522</td><td align="right">0.0079</td><td align="right">6.60</td><td align="right">&lt;1e-10</td><td align="right"> </td></tr><tr><td align="left">YA</td><td align="right">-0.0247</td><td align="right">0.0027</td><td align="right">-9.04</td><td align="right">&lt;1e-18</td><td align="right"> </td></tr><tr><td align="left">GC</td><td align="right">0.0745</td><td align="right">0.0027</td><td align="right">27.54</td><td align="right">&lt;1e-99</td><td align="right"> </td></tr><tr><td align="left">FRH &amp; RRH</td><td align="right">0.0042</td><td align="right">0.0097</td><td align="right">0.44</td><td align="right">0.6605</td><td align="right"> </td></tr><tr><td align="left">FRH &amp; YA</td><td align="right">0.0106</td><td align="right">0.0033</td><td align="right">3.24</td><td align="right">0.0012</td><td align="right"> </td></tr><tr><td align="left">FRH &amp; GC</td><td align="right">-0.0111</td><td align="right">0.0032</td><td align="right">-3.46</td><td align="right">0.0005</td><td align="right"> </td></tr><tr><td align="left">RRH &amp; YA</td><td align="right">-0.0015</td><td align="right">0.0033</td><td align="right">-0.47</td><td align="right">0.6384</td><td align="right"> </td></tr><tr><td align="left">RRH &amp; GC</td><td align="right">0.0078</td><td align="right">0.0032</td><td align="right">2.44</td><td align="right">0.0147</td><td align="right"> </td></tr><tr><td align="left">YA &amp; GC</td><td align="right">-0.0000</td><td align="right">0.0033</td><td align="right">-0.01</td><td align="right">0.9939</td><td align="right"> </td></tr><tr><td align="left">FRH &amp; FRH</td><td align="right">-0.0075</td><td align="right">0.0127</td><td align="right">-0.58</td><td align="right">0.5587</td><td align="right"> </td></tr><tr><td align="left">RRH &amp; RRH</td><td align="right">0.0291</td><td align="right">0.0127</td><td align="right">2.28</td><td align="right">0.0224</td><td align="right"> </td></tr><tr><td align="left">YA &amp; YA</td><td align="right">-0.0075</td><td align="right">0.0047</td><td align="right">-1.60</td><td align="right">0.1105</td><td align="right"> </td></tr><tr><td align="left">GC &amp; GC</td><td align="right">-0.0064</td><td align="right">0.0048</td><td align="right">-1.34</td><td align="right">0.1812</td><td align="right"> </td></tr><tr><td align="left">Residual</td><td align="right">0.0148</td><td align="right"></td><td align="right"></td><td align="right"></td><td align="right"></td></tr></table>
<p>Now we look at the adjustments made in the Kenward Roger approach. The p-values for the main effects of the hard-to-change factors are much larger. This is primarily because the degrees of freedom for these factors are very limited.</p><p>Similar results hold for the second-order terms. Terms involving only the hard-to-change factors have limited degrees of freedom. The interactions involving both a hard and an easy-to-change factor have similar degrees of freedom as terms only involving easy-to-change factors.</p><pre><code class="language-julia hljs">using MixedModelsSmallSample
kr = small_sample_adjust(m, KenwardRoger(; fim=ExpectedFIM()))</code></pre><table><tr><th align="left"></th><th align="right">Coef.</th><th align="right">Std. Error</th><th align="right">DenDF</th><th align="right">t</th><th align="right">Pr&#40;&gt;|t|&#41;</th></tr><tr><td align="left">&#40;Intercept&#41;</td><td align="right">0.91139</td><td align="right">0.011734</td><td align="right">4.2078</td><td align="right">77.669</td><td align="right">8.3744e-8</td></tr><tr><td align="left">FRH</td><td align="right">-0.060868</td><td align="right">0.0079025</td><td align="right">3.9751</td><td align="right">-7.7023</td><td align="right">0.0015681</td></tr><tr><td align="left">RRH</td><td align="right">0.052156</td><td align="right">0.0079025</td><td align="right">3.9751</td><td align="right">6.5999</td><td align="right">0.0027915</td></tr><tr><td align="left">YA</td><td align="right">-0.024719</td><td align="right">0.0027352</td><td align="right">31.03</td><td align="right">-9.0372</td><td align="right">3.3648e-10</td></tr><tr><td align="left">GC</td><td align="right">0.074543</td><td align="right">0.002711</td><td align="right">31.189</td><td align="right">27.497</td><td align="right">1.9693e-23</td></tr><tr><td align="left">FRH &amp; RRH</td><td align="right">0.0042487</td><td align="right">0.0096728</td><td align="right">3.9657</td><td align="right">0.43925</td><td align="right">0.68336</td></tr><tr><td align="left">FRH &amp; YA</td><td align="right">0.010584</td><td align="right">0.0032635</td><td align="right">31.025</td><td align="right">3.2431</td><td align="right">0.0028267</td></tr><tr><td align="left">FRH &amp; GC</td><td align="right">-0.011065</td><td align="right">0.0032021</td><td align="right">31.073</td><td align="right">-3.4556</td><td align="right">0.0016105</td></tr><tr><td align="left">RRH &amp; YA</td><td align="right">-0.0015368</td><td align="right">0.003271</td><td align="right">31.032</td><td align="right">-0.46982</td><td align="right">0.64177</td></tr><tr><td align="left">RRH &amp; GC</td><td align="right">0.0078247</td><td align="right">0.0032118</td><td align="right">31.114</td><td align="right">2.4362</td><td align="right">0.020759</td></tr><tr><td align="left">YA &amp; GC</td><td align="right">-2.5083e-5</td><td align="right">0.0032853</td><td align="right">31.383</td><td align="right">-0.007635</td><td align="right">0.99396</td></tr><tr><td align="left">FRH &amp; FRH</td><td align="right">-0.0074549</td><td align="right">0.012749</td><td align="right">4.0712</td><td align="right">-0.58477</td><td align="right">0.58958</td></tr><tr><td align="left">RRH &amp; RRH</td><td align="right">0.029096</td><td align="right">0.012743</td><td align="right">4.0641</td><td align="right">2.2833</td><td align="right">0.083427</td></tr><tr><td align="left">YA &amp; YA</td><td align="right">-0.0074878</td><td align="right">0.0047005</td><td align="right">31.21</td><td align="right">-1.593</td><td align="right">0.12124</td></tr><tr><td align="left">GC &amp; GC</td><td align="right">-0.0064216</td><td align="right">0.0048079</td><td align="right">31.11</td><td align="right">-1.3356</td><td align="right">0.19136</td></tr></table><p>The standard errors on the estimates are also slightly different. However, for this specific experiment, the adjustment does not have a large effect. An example where there is a large difference in standard error will be added later.</p><h2 id="Multiple-random-effects"><a class="docs-heading-anchor" href="#Multiple-random-effects">Multiple random effects</a><a id="Multiple-random-effects-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-random-effects" title="Permalink"></a></h2><pre><code class="language-julia hljs">using CSV
using DataFrames
using MixedModels

using MixedModelsSmallSample

df = DataFrame(MixedModels.dataset(:sleepstudy))
fm = @formula(reaction ~ 1 + days + (1 + days | subj))
m = fit(MixedModel, fm, df; REML=true)</code></pre><table><tr><th align="left"></th><th align="right">Est.</th><th align="right">SE</th><th align="right">z</th><th align="right">p</th><th align="right">σ_subj</th></tr><tr><td align="left">&#40;Intercept&#41;</td><td align="right">251.4051</td><td align="right">6.8246</td><td align="right">36.84</td><td align="right">&lt;1e-99</td><td align="right">24.7405</td></tr><tr><td align="left">days</td><td align="right">10.4673</td><td align="right">1.5458</td><td align="right">6.77</td><td align="right">&lt;1e-10</td><td align="right">5.9221</td></tr><tr><td align="left">Residual</td><td align="right">25.5918</td><td align="right"></td><td align="right"></td><td align="right"></td><td align="right"></td></tr></table>
<pre><code class="language-julia hljs">kr = small_sample_adjust(m, KenwardRoger(; fim=ExpectedFIM())) # or ObservedFIM()</code></pre><table><tr><th align="left"></th><th align="right">Coef.</th><th align="right">Std. Error</th><th align="right">DenDF</th><th align="right">t</th><th align="right">Pr&#40;&gt;|t|&#41;</th></tr><tr><td align="left">&#40;Intercept&#41;</td><td align="right">251.41</td><td align="right">6.8246</td><td align="right">17.0</td><td align="right">36.838</td><td align="right">1.1709e-17</td></tr><tr><td align="left">days</td><td align="right">10.467</td><td align="right">1.5458</td><td align="right">17.0</td><td align="right">6.7715</td><td align="right">3.2638e-6</td></tr></table><h2 id="More-examples"><a class="docs-heading-anchor" href="#More-examples">More examples</a><a id="More-examples-1"></a><a class="docs-heading-anchor-permalink" href="#More-examples" title="Permalink"></a></h2><h3 id="Scalar-Random-Effects"><a class="docs-heading-anchor" href="#Scalar-Random-Effects">Scalar Random Effects</a><a id="Scalar-Random-Effects-1"></a><a class="docs-heading-anchor-permalink" href="#Scalar-Random-Effects" title="Permalink"></a></h3><ul><li><a href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/master/test/bioequivalence%20homogeneous.jl">Bioequivalence (Homogeneous)</a></li><li><a href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/master/test/blocked%20experiment.jl">Blocked experiment</a></li><li><a href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/master/test/split%20plot%20experiment.jl">Split-plot experiment</a></li><li><a href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/master/test/strip%20plot%20experiment.jl">Strip-plot experiment</a></li></ul><h3 id="Vector-Random-Effects"><a class="docs-heading-anchor" href="#Vector-Random-Effects">Vector Random Effects</a><a id="Vector-Random-Effects-1"></a><a class="docs-heading-anchor-permalink" href="#Vector-Random-Effects" title="Permalink"></a></h3><ul><li><a href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/master/test/bioequivalence%20intermediate.jl">Bioequivalence (Intermediate)</a></li><li><a href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/master/test/random%20slope.jl">Single random slope</a></li></ul><h2 id="Similar-software"><a class="docs-heading-anchor" href="#Similar-software">Similar software</a><a id="Similar-software-1"></a><a class="docs-heading-anchor-permalink" href="#Similar-software" title="Permalink"></a></h2><ul><li>The R package <a href="https://github.com/hojsgaard/pbkrtest">pbkrtest</a></li><li><a href="https://www.jmp.com/support/help/en/18.1/index.shtml#page/jmp/statistical-details-for-the-kackarharville-correction-2.shtml#">JMP</a></li><li><a href="https://documentation.sas.com/doc/en/statcdc/14.2/statug/statug_glimmix_details40.htm">SAS</a></li></ul><h2 id="How-It-Works"><a class="docs-heading-anchor" href="#How-It-Works">How It Works</a><a id="How-It-Works-1"></a><a class="docs-heading-anchor-permalink" href="#How-It-Works" title="Permalink"></a></h2><p>The computations follow the same high-level flow for both Kenward-Roger and Satterthwaite:</p><ol><li>Compute <span>$V(\theta)$</span>, <span>$V(\theta)^{-1}$</span>, and derivative matrices for either <a href="#MixedModelsSmallSample.Unstructured"><code>Unstructured</code></a> or <a href="#MixedModelsSmallSample.FactorAnalytic"><code>FactorAnalytic</code></a>.</li><li>Compute <code>W = I(θ)^{-1}</code> via <a href="#MixedModelsSmallSample.vcov_varpar"><code>vcov_varpar</code></a>, using either <a href="#MixedModelsSmallSample.ObservedFIM"><code>ObservedFIM</code></a> or <a href="#MixedModelsSmallSample.ExpectedFIM"><code>ExpectedFIM</code></a>.</li><li>For <a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a>, compute the bias-corrected covariance of <code>β</code> (see <a href="#MixedModelsSmallSample.compute_adjusted_covariance"><code>MixedModelsSmallSample.compute_adjusted_covariance</code></a>).</li><li>Compute denominator degrees of freedom and (for KR) the F-scaling factor (see <a href="#MixedModelsSmallSample.compute_dof"><code>MixedModelsSmallSample.compute_dof</code></a>).</li></ol><h2 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h2><h3 id="Main-Functions"><a class="docs-heading-anchor" href="#Main-Functions">Main Functions</a><a id="Main-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Main-Functions" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.small_sample_adjust"><a class="docstring-binding" href="#MixedModelsSmallSample.small_sample_adjust"><code>MixedModelsSmallSample.small_sample_adjust</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">small_sample_adjust(m::MixedModel, method) -&gt; LinearMixedModelAdjusted</code></pre><p>Apply small-sample corrections to a fitted linear mixed model.</p><p>This is the main entry point for computing adjusted inference. The function:</p><ol><li>Validates that <code>m</code> is unweighted; <a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a> additionally requires a REML fit</li><li>Computes <span>$W = I(\theta)^{-1}$</span>, the asymptotic covariance of <span>$\hat{\theta}$</span> (see <a href="#MixedModelsSmallSample.vcov_varpar"><code>vcov_varpar</code></a>)</li><li>For <a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a>: computes adjusted covariance <span>$\Phi_A$</span></li></ol><p>(see <a href="#MixedModelsSmallSample.compute_adjusted_covariance"><code>compute_adjusted_covariance</code></a>)</p><ol><li>Computes denominator degrees of freedom <span>$\nu_k$</span> for each fixed effect (see <a href="#MixedModelsSmallSample.compute_dof"><code>compute_dof</code></a>)</li></ol><p><strong>Arguments</strong></p><ul><li><code>m::MixedModel</code>: A fitted <code>LinearMixedModel</code> from MixedModels.jl (must use REML for KR; ML or REML for SW)</li><li><code>method</code>: Either <a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a> or <a href="#MixedModelsSmallSample.Satterthwaite"><code>Satterthwaite</code></a></li></ul><p><strong>Returns</strong></p><ul><li><a href="#MixedModelsSmallSample.LinearMixedModelAdjusted"><code>LinearMixedModelAdjusted</code></a></li></ul><p>The returned object can be displayed to show adjusted coefficient tables with corrected standard errors (KR only) and degrees of freedom.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">using MixedModels, MixedModelsSmallSample
m = fit(MixedModel, @formula(y ~ x + (1|g)), data; REML=true)
kr = small_sample_adjust(m, KenwardRoger())
sw = small_sample_adjust(m, Satterthwaite())</code></pre><p><strong>See Also</strong></p><ul><li><a href="#MixedModelsSmallSample.small_sample_ftest"><code>small_sample_ftest</code></a>: Perform F-tests on contrasts</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/adjustment.jl#L52-L87">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.small_sample_ftest"><a class="docstring-binding" href="#MixedModelsSmallSample.small_sample_ftest"><code>MixedModelsSmallSample.small_sample_ftest</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">small_sample_ftest(m::LinearMixedModelAdjusted, L) -&gt; (ν, F*)</code></pre><p>Compute an adjusted F-test for the null hypothesis <span>$L^\top\beta = 0$</span>.</p><p>Returns <span>$(ν, F^*)$</span> where <span>$(ν, λ)$</span> is obtained from <a href="#MixedModelsSmallSample.compute_dof"><code>compute_dof</code></a> and <span>$F^* = λF$</span> with <span>$F = β^\top Mβ/q$</span> and <span>$M = L(L^\top\Phi L)^{-1}L^\top$</span> (using the unadjusted covariance <span>$\Phi$</span>).</p><p><strong>Arguments</strong></p><ul><li><code>m</code>: An adjusted model (<a href="#MixedModelsSmallSample.LinearMixedModelAdjusted"><code>LinearMixedModelAdjusted</code></a>)</li><li><code>L</code>: Contrast matrix (<span>$p \times q$</span>) where <span>$p$</span> = number of fixed effects</li></ul><p><strong>Returns</strong></p><ul><li><code>ν</code>: Denominator degrees of freedom</li><li><code>F*</code>: Scaled F-statistic</li></ul><p>Under <span>$H_0$</span>, <span>$F^* \sim F(q, \nu)$</span> approximately.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">kr = small_sample_adjust(model, KenwardRoger())
L = [0 1 0; 0 0 1]&#39;  # Test β₂ = β₃ = 0
ν, Fstar = small_sample_ftest(kr, L)
pvalue = 1 - cdf(FDist(size(L,2), ν), Fstar)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/ftest.jl#L1-L28">source</a></section><section><div><pre><code class="language-julia hljs">small_sample_ftest(m::MixedModel, L; method=KenwardRoger()) -&gt; (ν, F*)</code></pre><p>Convenience wrapper that first applies <a href="#MixedModelsSmallSample.small_sample_adjust"><code>small_sample_adjust</code></a> then computes the F-test.</p><p>Equivalent to:</p><pre><code class="language-julia hljs">m_adj = small_sample_adjust(m, method)
small_sample_ftest(m_adj, L)</code></pre><p><strong>Arguments</strong></p><ul><li><code>m</code>: A fitted <code>MixedModel</code> (must use REML for KR; ML or REML for SW)</li><li><code>L</code>: Contrast matrix</li><li><code>method</code>: <a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a> or <a href="#MixedModelsSmallSample.Satterthwaite"><code>Satterthwaite</code></a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/ftest.jl#L39-L55">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.vcov_varpar"><a class="docstring-binding" href="#MixedModelsSmallSample.vcov_varpar"><code>MixedModelsSmallSample.vcov_varpar</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">vcov_varpar(m::MixedModel; fim=ObservedFIM(), parameterization=Unstructured())</code></pre><p>Compute <code>W = I(θ)^{-1}</code>, the asymptotic covariance of the fitted variance parameters.</p><p>The Fisher information <code>I(θ)</code> is computed using either <a href="#MixedModelsSmallSample.ObservedFIM"><code>ObservedFIM</code></a> or <a href="#MixedModelsSmallSample.ExpectedFIM"><code>ExpectedFIM</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/fisher_information.jl#L71-L77">source</a></section></details></article><h3 id="Adjustment-Methods"><a class="docs-heading-anchor" href="#Adjustment-Methods">Adjustment Methods</a><a id="Adjustment-Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Adjustment-Methods" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.KenwardRoger"><a class="docstring-binding" href="#MixedModelsSmallSample.KenwardRoger"><code>MixedModelsSmallSample.KenwardRoger</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">KenwardRoger(; fim=ObservedFIM(), parameterization=Unstructured())</code></pre><p>Kenward-Roger method for <a href="#MixedModelsSmallSample.small_sample_adjust"><code>small_sample_adjust</code></a> and <a href="#MixedModelsSmallSample.small_sample_ftest"><code>small_sample_ftest</code></a>.</p><p>See also <a href="#MixedModelsSmallSample.Satterthwaite"><code>Satterthwaite</code></a> for an alternative method.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/types.jl#L140-L146">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.Satterthwaite"><a class="docstring-binding" href="#MixedModelsSmallSample.Satterthwaite"><code>MixedModelsSmallSample.Satterthwaite</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">Satterthwaite(; fim=ObservedFIM(), parameterization=Unstructured())</code></pre><p>Satterthwaite method for <a href="#MixedModelsSmallSample.small_sample_adjust"><code>small_sample_adjust</code></a> and <a href="#MixedModelsSmallSample.small_sample_ftest"><code>small_sample_ftest</code></a>.</p><p>See also <a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a> for an alternative method.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/types.jl#L160-L166">source</a></section></details></article><h3 id="Options"><a class="docs-heading-anchor" href="#Options">Options</a><a id="Options-1"></a><a class="docs-heading-anchor-permalink" href="#Options" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.ObservedFIM"><a class="docstring-binding" href="#MixedModelsSmallSample.ObservedFIM"><code>MixedModelsSmallSample.ObservedFIM</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">ObservedFIM</code></pre><p>Use the observed (Hessian-based) Fisher Information Matrix for the variance parameters.</p><p>Let <span>$V$</span>, <span>$V^{-1}$</span>, <span>$dV_i$</span> and <span>$d^2V_{ij}$</span> come from <a href="#MixedModelsSmallSample.VarianceDecomposition"><code>VarianceDecomposition</code></a>. Define</p><p class="math-container">\[\Phi = (X^\top V^{-1} X)^{-1},\qquad
P = V^{-1} - V^{-1}X\,\Phi\,X^\top V^{-1},\qquad
r = y - X\hat{\beta}.\]</p><p>Then the observed information is</p><p class="math-container">\[I^{\text{obs}}_{ij}(\theta) =
-\frac{1}{2}\operatorname{tr}\left(P dV_i P dV_j\right)
+ r^{\top} V^{-1} dV_i P dV_j V^{-1} r
+ \frac{1}{2}\operatorname{tr}\left(P d^2V_{ij}\right)
- \frac{1}{2} r^{\top} V^{-1} d^2V_{ij} V^{-1} r.\]</p><p><strong>See Also</strong></p><ul><li><a href="#MixedModelsSmallSample.ExpectedFIM"><code>ExpectedFIM</code></a>: Alternative using expected values</li><li><a href="#MixedModelsSmallSample.vcov_varpar"><code>vcov_varpar</code></a>: Computes the inverse of the FIM</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/types.jl#L9-L36">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.ExpectedFIM"><a class="docstring-binding" href="#MixedModelsSmallSample.ExpectedFIM"><code>MixedModelsSmallSample.ExpectedFIM</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">ExpectedFIM</code></pre><p>Use the expected Fisher Information Matrix for the variance parameters.</p><p>Let <span>$V^{-1}$</span>, <span>$dV_i$</span>, <span>$P_i$</span> and <span>$Q_{ij}$</span> come from <a href="#MixedModelsSmallSample.VarianceDecomposition"><code>VarianceDecomposition</code></a>, and define <span>$\Phi = (X^\top V^{-1} X)^{-1}$</span>.</p><p>Then the expected information used by <a href="#MixedModelsSmallSample.vcov_varpar"><code>vcov_varpar</code></a> is</p><p class="math-container">\[I^{\text{exp}}_{ij}(\theta) = \frac{1}{2}\operatorname{tr}\left(V^{-1} dV_i V^{-1} dV_j\right)
- \operatorname{tr}(\Phi\,Q_{ij})
+ \frac{1}{2}\operatorname{tr}(\Phi\,P_i\,\Phi\,P_j).\]</p><p><strong>See Also</strong></p><ul><li><a href="#MixedModelsSmallSample.ObservedFIM"><code>ObservedFIM</code></a>: Alternative using observed Hessian</li><li><a href="#MixedModelsSmallSample.vcov_varpar"><code>vcov_varpar</code></a>: Computes the inverse of the FIM</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/types.jl#L39-L58">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.Unstructured"><a class="docstring-binding" href="#MixedModelsSmallSample.Unstructured"><code>MixedModelsSmallSample.Unstructured</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">Unstructured</code></pre><p>Unstructured (variance component) parameterization.</p><p>In this parameterization, the marginal variance is linear in the variance parameters. Writing the model as <span>$V(\theta) = \sigma^2 I_n + \sum_b Z_b G_b(\theta) Z_b^\top$</span>, <code>Unstructured</code> parameterizes each block covariance <span>$G_b(\theta)$</span> by its unique (co)variance components.</p><p><strong>Gradient Structure</strong></p><p>Because <span>$V$</span> is linear in <span>$\theta$</span>, the derivatives are trivial: each <span>$\partial V/\partial\theta_i$</span> is constant and <span>$\partial^2 V/(\partial\theta_i\,\partial\theta_j) = 0$</span>.</p><p>This implies the <span>$R_{ij}$</span> terms used by the Kenward-Roger covariance correction vanish.</p><p><strong>See Also</strong></p><ul><li><a href="#MixedModelsSmallSample.FactorAnalytic"><code>FactorAnalytic</code></a>: Alternative Cholesky-based parameterization</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/types.jl#L62-L82">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.FactorAnalytic"><a class="docstring-binding" href="#MixedModelsSmallSample.FactorAnalytic"><code>MixedModelsSmallSample.FactorAnalytic</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">FactorAnalytic</code></pre><p>Factor analytic (Cholesky) parameterization.</p><p>For each random-effects block <span>$b$</span>, decompose the block covariance as <span>$G_b = L_b L_b^\top$</span> with <span>$L_b$</span> lower triangular. The variance parameters are <span>$\sigma^2$</span> and the free elements of the <span>$L_b$</span>.</p><p>The marginal variance is</p><p class="math-container">\[V = \sigma^2 I_n + \sum_b Z_b G_b Z_b^\top = \sigma^2 I_n + \sum_b Z_b L_b L_b^\top Z_b^\top.\]</p><p>For MixedModels.jl models, the internal random-effects factor is stored as a relative factor <span>$\lambda_b$</span>; we use the scaled factor <span>$L_b = \sigma\,\lambda_b$</span>.</p><p><strong>Derivatives of V</strong></p><p>The derivative of <span>$V$</span> with respect to a Cholesky element <span>$L_{b,ij}$</span> uses the chain rule through <span>$G_b = L_b L_b^\top$</span>:</p><p class="math-container">\[\frac{\partial V}{\partial L_{ij}} = Z_b \frac{\partial G_b}{\partial L_{ij}} Z_b^\top,
\qquad
\frac{\partial G_b}{\partial L_{ij}} = E_{ij} L_b^\top + L_b E_{ij}^\top,\]</p><p>where <span>$E_{ij}$</span> is the elementary matrix with a 1 at position <span>$(i,j)$</span>.</p><p>The second derivatives are non-zero. For indices within the same block,</p><p class="math-container">\[\frac{\partial^2 G_b}{\partial L_{i_1 j_1}\,\partial L_{i_2 j_2}}
= \delta_{j_1 j_2}\,(E_{i_1 i_2} + E_{i_2 i_1}),\]</p><p>and hence</p><p class="math-container">\[\frac{\partial^2 V}{\partial L_{i_1 j_1}\,\partial L_{i_2 j_2}}
= Z_b\,\frac{\partial^2 G_b}{\partial L_{i_1 j_1}\,\partial L_{i_2 j_2}}\,Z_b^\top.\]</p><p>Unlike <a href="#MixedModelsSmallSample.Unstructured"><code>Unstructured</code></a>, this parameterization has <strong>non-zero second derivatives</strong> <span>$\partial^2 V / \partial L_{ij} \partial L_{kl}$</span>, which must be included in the Kenward-Roger bias correction.</p><p><strong>See Also</strong></p><ul><li><a href="#MixedModelsSmallSample.Unstructured"><code>Unstructured</code></a>: Alternative with zero second derivatives</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/types.jl#L85-L136">source</a></section></details></article><h3 id="Result-Types"><a class="docs-heading-anchor" href="#Result-Types">Result Types</a><a id="Result-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Result-Types" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.LinearMixedModelAdjusted"><a class="docstring-binding" href="#MixedModelsSmallSample.LinearMixedModelAdjusted"><code>MixedModelsSmallSample.LinearMixedModelAdjusted</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">LinearMixedModelAdjusted{T&lt;:LinearMixedModel, O&lt;:AbstractLinearMixedModelAdjustment}</code></pre><p>A wrapper around a <code>LinearMixedModel</code> that holds the small-sample adjusted results.</p><p><strong>Fields</strong></p><ul><li><code>m</code>: The original <code>LinearMixedModel</code>.</li><li><code>adj</code>: The adjustment option used (<a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a> or <a href="#MixedModelsSmallSample.Satterthwaite"><code>Satterthwaite</code></a>).</li><li><code>varcovar_adjusted</code>: The adjusted variance-covariance matrix of the fixed effects (corrected for KR, unadjusted for SW).</li><li><code>W</code>: The asymptotic covariance matrix of the variance parameters.</li><li><code>P</code>: Derived matrix (P_i).</li><li><code>Q</code>: Derived matrix (Q_{ij}) (optional, <code>nothing</code> for Satterthwaite).</li><li><code>R</code>: Derived matrix (R_{ij}) (optional, <code>nothing</code> for Satterthwaite).</li><li><code>R_factor</code>: Scaling factor for (R_{ij}) (0.0 for Satterthwaite).</li><li><code>ν</code>: The denominator degrees of freedom for each fixed effect coefficient.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/types.jl#L217-L232">source</a></section></details></article><h2 id="Internals"><a class="docs-heading-anchor" href="#Internals">Internals</a><a id="Internals-1"></a><a class="docs-heading-anchor-permalink" href="#Internals" title="Permalink"></a></h2><p>These types and functions are not exported but may be useful for understanding or extending the package.</p><h3 id="Variance-Decomposition"><a class="docs-heading-anchor" href="#Variance-Decomposition">Variance Decomposition</a><a id="Variance-Decomposition-1"></a><a class="docs-heading-anchor-permalink" href="#Variance-Decomposition" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.VarianceDecomposition"><a class="docstring-binding" href="#MixedModelsSmallSample.VarianceDecomposition"><code>MixedModelsSmallSample.VarianceDecomposition</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">VarianceDecomposition</code></pre><p>Cached matrices derived from the marginal covariance <code>V(θ)</code> and its derivatives.</p><p>Let <code>θs</code> denote the variance parameters, and write <code>dVs[i] = ∂V/∂θ_i</code> and <code>d2Vs[i,j] = ∂²V/(∂θ_i∂θ_j)</code>.</p><p>This struct stores <code>V</code>, <code>Vinv</code>, <code>θs</code>, <code>dVs</code>, <code>d2Vs</code>, and the derived matrices</p><p class="math-container">\[P_i = -X^\top V^{-1} dV_i V^{-1} X,
\qquad
Q_{ij} = X^\top V^{-1} dV_i V^{-1} dV_j V^{-1} X,
\qquad
R_{ij} = X^\top V^{-1} d^2V_{ij} V^{-1} X,\]</p><p>and <code>R_factor</code>. <code>R_factor</code> is a parameterization-dependent scalar applied to <code>R_{ij}</code> in the Kenward-Roger covariance bias correction (see <a href="#MixedModelsSmallSample.compute_adjusted_covariance"><code>compute_adjusted_covariance</code></a>).</p><p>The definition of <code>θ</code> (and thus the rest of the calculated quantities here) depends on the chosen parameterization; see <a href="#MixedModelsSmallSample.Unstructured"><code>Unstructured</code></a> and <a href="#MixedModelsSmallSample.FactorAnalytic"><code>FactorAnalytic</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/types.jl#L180-L203">source</a></section></details></article><h3 id="Covariance-Adjustment-Computation"><a class="docs-heading-anchor" href="#Covariance-Adjustment-Computation">Covariance Adjustment Computation</a><a id="Covariance-Adjustment-Computation-1"></a><a class="docs-heading-anchor-permalink" href="#Covariance-Adjustment-Computation" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.compute_adjusted_covariance"><a class="docstring-binding" href="#MixedModelsSmallSample.compute_adjusted_covariance"><code>MixedModelsSmallSample.compute_adjusted_covariance</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">compute_adjusted_covariance(Φ, vd, W, method) -&gt; Matrix</code></pre><p>Compute the (possibly adjusted) covariance matrix of fixed effects.</p><p>For <a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a>, applies the bias correction:</p><p class="math-container">\[\Phi_A = \hat{\Phi} + 2\hat{\Phi}\,B\,\hat{\Phi},\]</p><p>where the bias matrix <span>$B$</span> accounts for the variability in estimating <span>$\theta$</span>:</p><p class="math-container">\[B = \sum_{i,j} W_{ij} \bigl(Q_{ij} - P_i\hat{\Phi}P_j + R_{\text{factor}}\cdot R_{ij}\bigr).\]</p><p>Here <span>$W$</span> is the asymptotic covariance of <span>$\hat{\theta}$</span>, and <span>$P_i, Q_{ij}, R_{ij}$</span> are defined in <a href="#MixedModelsSmallSample.VarianceDecomposition"><code>VarianceDecomposition</code></a>. The <code>R_factor</code> is <code>-1/4</code> for <a href="#MixedModelsSmallSample.FactorAnalytic"><code>FactorAnalytic</code></a> parameterization and <code>1</code> for <a href="#MixedModelsSmallSample.Unstructured"><code>Unstructured</code></a>.</p><p>For <a href="#MixedModelsSmallSample.Satterthwaite"><code>Satterthwaite</code></a>, returns <span>$\Phi$</span> unchanged (no bias correction).</p><p><strong>Arguments</strong></p><ul><li><code>Φ</code>: Unadjusted covariance matrix <span>$(X^\top V^{-1} X)^{-1}$</span></li><li><code>vd</code>: <a href="#MixedModelsSmallSample.VarianceDecomposition"><code>VarianceDecomposition</code></a> containing derivative matrices</li><li><code>W</code>: Asymptotic covariance of variance parameters</li><li><code>method</code>: Adjustment method (<a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a> or <a href="#MixedModelsSmallSample.Satterthwaite"><code>Satterthwaite</code></a>)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/adjustment.jl#L12-L40">source</a></section></details></article><h3 id="Degrees-of-Freedom-Computation"><a class="docs-heading-anchor" href="#Degrees-of-Freedom-Computation">Degrees of Freedom Computation</a><a id="Degrees-of-Freedom-Computation-1"></a><a class="docs-heading-anchor-permalink" href="#Degrees-of-Freedom-Computation" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="MixedModelsSmallSample.compute_dof"><a class="docstring-binding" href="#MixedModelsSmallSample.compute_dof"><code>MixedModelsSmallSample.compute_dof</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">compute_dof(m::LinearMixedModelAdjusted, L) -&gt; (ν, λ)</code></pre><p>Compute degrees of freedom and F-statistic scaling factor for contrast <code>L</code>.</p><p>Dispatches to the specific method based on <code>m.adj</code>:</p><ul><li>For <a href="#MixedModelsSmallSample.KenwardRoger"><code>KenwardRoger</code></a>: computes scaled F-statistic with <span>$λ ≠ 1$</span></li><li>For <a href="#MixedModelsSmallSample.Satterthwaite"><code>Satterthwaite</code></a>: returns <span>$λ = 1$</span> (no scaling)</li></ul><p><strong>Arguments</strong></p><ul><li><code>m</code>: A <a href="#MixedModelsSmallSample.LinearMixedModelAdjusted"><code>LinearMixedModelAdjusted</code></a> from <a href="#MixedModelsSmallSample.small_sample_adjust"><code>small_sample_adjust</code></a></li><li><code>L</code>: Contrast matrix (<span>$p × q$</span>) where <span>$p$</span> = number of fixed effects</li></ul><p><strong>Returns</strong></p><ul><li><code>ν</code>: Denominator degrees of freedom</li><li><code>λ</code>: F-statistic scaling factor (1.0 for Satterthwaite)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/dof_computation.jl#L1-L17">source</a></section><section><div><pre><code class="language-julia hljs">compute_dof(::KenwardRoger, m, L)</code></pre><p>Kenward-Roger denominator degrees of freedom and F-scaling factor.</p><p>For testing <span>$H_0: L^\top\beta = 0$</span> with <span>$q$</span> constraints, the standard Wald F-statistic <span>$F = \beta^\top M \beta / q$</span> (where <span>$M = L(L^\top\Phi L)^{-1}L^\top$</span>) is scaled to <span>$F^* = \lambda F$</span>. The pair <span>$(\nu, \lambda)$</span> is chosen so that <span>$F^*$</span> approximately follows an <span>$F(q, \nu)$</span> distribution.</p><p><strong>Algorithm</strong></p><ol><li><p>Compute moment quantities:</p><p class="math-container">\[A_1 = \sum_{i,j} W_{ij} \operatorname{tr}(M\Phi P_i \Phi) \operatorname{tr}(M\Phi P_j \Phi)\]</p><p class="math-container">\[A_2 = \sum_{i,j} W_{ij} \operatorname{tr}(M\Phi P_i \Phi\, M\Phi P_j \Phi)\]</p></li><li><p>Compute intermediate terms:</p><p class="math-container">\[B = \frac{A_1 + 6A_2}{2q}, \quad
g = \frac{(q+1)A_1 - (q+4)A_2}{(q+2)A_2}\]</p><p class="math-container">\[c_1 = \frac{g}{3q + 2(1-g)}, \quad
c_2 = \frac{q-g}{3q + 2(1-g)}, \quad
c_3 = \frac{q+2-g}{3q + 2(1-g)}\]</p></li><li><p>Compute expectation and variance of the scaled statistic:</p><p class="math-container">\[E^* = \frac{1}{1 - A_2/q}, \quad
V^* = \frac{2}{q} \cdot \frac{1 + c_1 B}{(1-c_2 B)^2 (1-c_3 B)}\]</p></li><li><p>Match to F-distribution moments:</p><p class="math-container">\[\rho = \frac{V^*}{2(E^*)^2}, \quad
\nu = 4 + \frac{q+2}{q\rho - 1}, \quad
\lambda = \frac{\nu}{E^*(\nu - 2)}\]</p></li></ol></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/dof_computation.jl#L22-L65">source</a></section><section><div><pre><code class="language-julia hljs">compute_dof(::Satterthwaite, m, L)</code></pre><p>Satterthwaite denominator degrees of freedom for contrast <code>L</code>.</p><p>For a scalar contrast <span>$c^\top\beta$</span>, the variance is <span>$v = c^\top\Phi\,c$</span>. The Satterthwaite approximation matches the first two moments of <span>$\hat{v}$</span> to a scaled chi-squared distribution, yielding:</p><p class="math-container">\[\nu = \frac{2v^2}{(\nabla_\theta v)^\top W (\nabla_\theta v)},\]</p><p>where the gradient is <span>$\nabla_\theta v = [-c^\top\Phi\,P_i\,\Phi\,c]_i$</span> and <span>$W$</span> is the asymptotic covariance of <span>$\hat{\theta}$</span>.</p><p><strong>Multivariate Contrasts</strong></p><p>For a matrix <span>$L$</span> (multiple constraints), the algorithm:</p><ol><li>Computes the eigendecomposition of <span>$L^\top\Phi\,L$</span></li><li>Transforms to orthogonal contrasts <span>$\tilde{L} = L \cdot \text{eigenvectors}$</span></li><li>Computes <span>$\nu_i$</span> for each orthogonal contrast</li><li>Combines using: <span>$\nu = 2 E_Q / (E_Q - q)$</span> where <span>$E_Q = \sum_i \nu_i/(\nu_i - 2)$</span></li></ol><p><strong>Reference</strong></p><p>Satterthwaite, F. E. (1946). &quot;An Approximate Distribution of Estimates of Variance Components.&quot; <em>Biometrics Bulletin</em>, 2(6), 110-114.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ArnoStrouwen/MixedModelsSmallSample.jl/blob/1e9608542c3266c763784aade655af09e414d5dc/src/dof_computation.jl#L97-L125">source</a></section></details></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Sunday 25 January 2026 21:37">Sunday 25 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
